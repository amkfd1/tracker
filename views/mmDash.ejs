
<%- include('partials/head') %>
<style>
    .appIcons{
        width: 15px;
        height: 15px;
    }
    .text-mkel{
      color: #63D2FF;
    }
</style>
<body class="sidebar-dark">
	<div class="main-wrapper">
    <%- include('includes/_sidebar-mm') %>
  
      <div class="page-wrapper">
        <%if (designation == "Admin" || designation == "Management" ) {%>
          <%- include('includes/_sidebar') %>
        <%} else {%>
          <%- include('includes/_sidebar-mm') %>
          
        <%}%>
			<div class="page-content d-flex align-items-center justify-content-center mt-4" style="margin-top: 0;">

				<div class="card " style=" width: 100%; height: 100vh; ">
                    
					<div class="card-body card-body-alt px-5" >
						
                        <!-- <div class=""> -->
                            <div class="col-md-8">
                                <h5 class="card-title mb-3"> Dashboard</h5>
                           </div>



							              <div class="row">
                                <div class="col-md-4">   
                                    <!--  -->
                                    <div class="card bg-dark card-body-hor"  style="height: 10rem; border-radius: 20px;">
                                        <!-- <div class="row"> -->
                                          <label class="text-muted ml-2 mt-2">SMS Stats:
                                          </label>
                                          <div class="row">
                                            <div class="col mx-1">
                                              
                                              <label>Daily SMS Count</label>
                                              <h4 class="text-primary text-center my-2"><%=dailySMS%></h4>
                                              <p class="text-danger text-center">
                                                <span>-1.1%</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down icon-sm mb-1"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                                              </p>
                                            </div>
                                            <div class="col mx-1">
                                              <label>Weekly SMS Count</label>
                                              <h4 class="text-primary my-2 text-center"><%=weeklySMS%></h4>
                                              <p class="text-success text-center">
                                                <span>+1.7%</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up icon-sm mb-1"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                                              </p>
                                            </div>
                                          </div>
                                        <!-- </div> -->
                                    </div>
                                </div>
                                <div class="col-md-4">   
                                    <!--  -->
                                    <div class="card bg-dark card-body-hor"  style="height: 10rem; border-radius: 20px;">
                                      <label class="text-muted ml-2 mt-2">VoIP Stats:
                                      </label>
                                      <div class="row">
                                        <div class="col mx-1">
                                          
                                          <label>Daily Minutes</label>
                                          <h4 class="text-mkel my-2 text-center"><%=dailyMinutesSum%></h4>
                                          <p class="text-success text-center">
                                            <span>+1.4%</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up icon-sm mb-1"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>

                                          </p>
                                        </div>
                                        <div class="col">
                                          <label>Weekly Minutes</label>
                                          <h4 class="text-mkel my-2 text-center"><%=weeklyMinutesSum%></h4>
                                          <p class="text-danger text-center">
                                            <span>-0.8%</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down icon-sm mb-1"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>

                                          </p>
                                        </div>
                                      </div>
                                    </div>
                                </div>
                               
                               <div class="col-md-4">   
                                <!--  -->
                                <div class="card bg-dark"  style="height: 10rem; border-radius: 20px;">
                                    <ul class="list-group bg-dark list-group-flush card-body-hor py-2">
                                        <li class="list-group-item bg-dark">
                                            <div class="row">
                                                <div class="col-md-6 card bg-transparent">
                                                    <label class="text-muted">TASKS:
                                                        <span class="float-right">
                                                            <a href="#" data-toggle="modal" data-target=".myClients">
                                                                <i class="appIcons text-muted" data-feather="maximize-2" ></i>
                                                        
                                                            </a>
                                                        </span>
                                                    </label>
                                                    
                                                    
                                                    <h5 class="text-info"><%= assignedTrackers.length %></h5>
                                                </div>
                                                <div class="col-md-6 card bg-transparent">
                                                    <label class="text-muted">USERS:
                                                        <span class="float-right">
                                                            <a href="#" data-toggle="modal" data-target=".bd-example-modal-lg">
                                                                 <i class="appIcons text-muted" data-feather="maximize-2" ></i>
                                                             </a>
                                                         </span>
                                                    </label>
                                                    
                                                    <h5 class="text-warning"><%= users.length%></h5>
                                                </div>
                                            </div>						
                                        </li>
                                        
                                        <li class="list-group-item bg-transparent">
                                            <div class="row">
                                                <div class="col-md-6 card bg-transparent">
                                                    <label class="text-muted">Completed:
                                                        <!-- <span class="float-right">
                                                            <i class="appIcons text-muted" data-feather="external-link" ></i>
                                                        </span> -->
                                                    </label>
                                                    
                                                    <a><h5 class="text-success"><%= completedPercentile%>%</h5></a>
                                                </div>
                                                <div class="col-md-6 card bg-transparent">
                                                    <label class="text-muted">Incomplete:
                                                    </label>
                                                    <!-- <span class="float-right">
                                                        <i class="appIcons text-muted" data-feather="external-link" ></i>
                                                    </span> -->
                                                    <a><h5 class="text-danger"><%= incompletePercentile%>%</h5></a>
                                                    
                                                </div>
                                            </div>	
                                        </li>
                                        
                                    </ul>
                                </div>
                                <!--  -->
                                
                                   
                                </div>
                            </div>
                            		
                            
                        <!-- </div> end of first row div -->

                        <div class="row " style="max-height: 40rem;">
                          <div class="col-md-6">
                            <div class="card-body">
                              <div class="d-flex justify-content-between align-items-baseline mb-2">
                                <h6 class="card-title mb-0">Carriers Daily Minutes</h6>
                              </div>
                              <p class="text-muted mb-4">Daily active traffic minutes</p>
                              <div class="monthly-sales-chart-wrapper"><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>
                                <canvas id="monthly-sales-chart" style="display: block; width: 656px; height: 300px;" width="656" height="300" class="chartjs-render-monitor"></canvas>
                              </div>
                            </div>
                          </div>

                        
                          <div class="col-md-6">
                              <div class="card-body mb-2">
                                  <div class="d-flex justify-content-between align-items-baseline mb-4 mb-md-3">
                                    <h6 class="card-title mb-0">Partners' SMS Stats</h6>
                                  </div>
                                  <p class="text-muted mb-4">Active carriers daily SMS</p>

                                  <div class="monthly-sales-chart-wrapper"><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>

                                    <canvas id="chartjsBar" style="display: block; width: 520px; height: 280px;" width="520" height="280" class="chartjs-render-monitor"></canvas>
                                  </div>
                                </div>
                          </div>
                          
                        </div> 
                        
                    <div class="border-bottom"></div>
                    <div class="border-bottom"></div>
                        
                    <div class="col-md-8 mt-3">
                      <h5 class="card-title mb-3"> Partners Table</h5>
                    </div>

                    <section class="mt-3 mb-5">
                      <div class="table-responsive ">
                          <table class="table table-striped " id="voipTable">
                              <thead class="border-info">
                                  <tr>
                                      <th>
                                          Company
                                      </th>
                                      <th>
                                          Stage
                                      </th>
                                      <th>
                                          Account Manager
                                      </th>
                                      <th>
                                          Status
                                      </th>
                                      <th>
                                          Service
                                      </th>
                                      
                                  </tr>
                              </thead>
                              <tbody>
                                  <% for (i in trackers) {%>

                                      <tr>
                                          <td class="py-1">
                                              <a href="/mm/tracker/<%= trackers[i]._id%>"><%= trackers[i].Customer_Name%></a>
                                          </td>
                                          <td>
                                              <div class="dropdown">
                                                  
                                                  <button class="btn btn-dark bg-transparent dropdown-toggle" type="button" id="dropdownMenuButton4" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                      <%= trackers[i].stage.process_stage%>
                                                  </button>
                                                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton4">

                                                      <%for (j in stages) {%>
                                                          
                                                          <form action="/mm/updateStage/<%= trackers[i]._id%>" method="post">
                                                              <button type="submit"  class="dropdown-item" style="border:none;">
                                                                  <%= stages[j]%>
                                                              </button>
                                                              <input type="hidden" name="stage" value="<%= stages[j]%>">
                                                          </form>
                                                      <% } %>
                                                      <div class="dropdown-divider"></div>
                                                      
                                                  </div>
                                              </div>
                                              

                                          </td>
                                          <td>
                                              <% if (trackers[i].account_manager) {%>

                                                  <%=trackers[i].account_manager.name%>
                                              <% } else { %>
                                                  NA
                                              <% } %>
                                          </td>
                                          <td>
                                              <div class="progress">
                                                  <% if (trackers[i].stage.status === '' || trackers[i].stage.status === 'NA'){%>
                                                      <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: 5%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                                                          <%= trackers[i].stage.status%>
                                                      
                                                      </div>
                                                  <%} else if (trackers[i].stage.status === 'Initiated') {%>
                                                      <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">
                                                          <%= trackers[i].stage.status%>
                                                      
                                                      </div>
                                                  <% } else if (trackers[i].stage.status === 'Ongoing' || trackers[i].stage.status === 'Incomplete'  ) {%>
                                                      <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" style="width: 60%;" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">
                                                          <%= trackers[i].stage.status%>
                                                      
                                                      </div>
                                                  <% } else if (trackers[i].stage.status === 'Complete' || trackers[i].stage.status === 'Completed'  ) {%>
                                                      <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                                                          <%= trackers[i].stage.status%>
                                                      
                                                      </div>
                                                  <% } else { %>
                                                      <div class="progress-bar progress-bar-striped progress-bar-animated
                                                      <%if (trackers[i].completionPercentage <40 ){%> bg-danger  %>
                                                      <%}else if (trackers[i].completionPercentage > 30 && trackers[i].completionPercentage <= 60) {%>
                                                           bg-warning																
                                                      <%}else %> bg-success " role="progressbar" style="width: 100%;"  aria-valuenow="<%= trackers[i].completionPercentage%>" aria-valuemin="0" aria-valuemax="100">
                                                          <%= trackers[i].completionPercentage%>
                                                      
                                                      </div>
                                                  <% } %>
                                              </div>
                                          </td>
                                          <td>
                                              <%= trackers[i].service_interest.service_name%>

                                          </td>
                                          
                                      </tr>
                                  <% } %>
                              </tbody>
                          </table>
                      </div>		
                    </section>

                    <div class="border-bottom "></div>
                    <div class="border-bottom "></div>
                    <div class="col-md-8 mt-3">
                      <h5 class="card-title mb-3"> Staff & Tasks</h5>
                 </div>
                    <div class="row ">
                        <div class="col">
                          <section class="mx-4 border-light">
                            <h4 class="card-title mt-5">
                              TASKS
                              
                              <a href="#" class="float-right mx-3" data-toggle="modal" data-target="#tasks_" data-whatever="@fat">
                                <i data-feather="plus"></i>
                              </a>
                            </h4>
                            <div class="table-responsive card-body-hor ">
                              
            
                              <table class="table table-striped " >
                                <thead class="border-info">
                                  <tr>
                                    <th>
                                      Task
                                    </th>
                                    
                                    <th>
                                      Status
                                    </th>
                                    <th>
            
                                    </th>
                                    
                                  </tr>
                                </thead>
                                <tbody>
                                    <% for (i in tasks) { %>
                                  <tr>
            
                                        <td>
                                          <a href="/mm/task/<%= tasks[i]._id%>" class="mx-2 " data-toggle="modal" data-target=".bd-example-modal-lg-full-tasks<%=[i]%>">
                                            <%= tasks[i].title %>
                                          </a>
                                        </td>
                                        <td>
                                          <%if (tasks[i].status == 'Active' || tasks[i].status == 'Close' ) {%>
                                            <span class="text-success"><%= tasks[i].status %></span>
                                        
                                          <% } else if (tasks[i].status == 'Ongoing'){%>
                                            <span class="text-warning"><%= tasks[i].status %></span>
            
                                          <% } else {%>
                                            <span class="text-danger"><%= tasks[i].status %></span>
                                          <%}%>
                                        <td>
                                          <div class="d-flex justify-content-center align-items-center">
                                            <a href="/mm/task/<%= tasks[i]._id %>" class="mx-2 text-info" >
                                              <i class="appIcons" data-feather="edit-2"></i>
                                            </a>
                                                                            
                                          </div>
                                          <!-- Full TASKS expand -->
                                        <%- include('partials/task') %>
                                        </td>
                                        
                                  </tr>
                                      
                                    <% } %>
                                </tbody>
                                
                              </table>
                            </div>		
                          </section>
                        </div>


                        <div class="col">
                          <section class="mx-3 ">
                            <h4 class="card-title mt-5">
                              USERS
                              
                            </h4>
                            <div class="mt-3 card-body-hor" style="max-height: 300px; width: 100%;">
                              <%for (i in users) {%>
                                <a href="#" class="d-flex align-items-center border-bottom " data-toggle="modal" data-target="#records<%=[i]%>">
                                  <div class="mr-3">
                                    <img src="https://via.placeholder.com/35x35" class="rounded-circle wd-35" alt="user">
                                  </div>
                                  <div class="w-100">
                                    <div class="d-flex justify-content-between">
                                    <h6 class="text-body my-2"><%= users[i].name%></h6>
                                    <p class="my-2 px-2 <%if (users[i].role == 'Admin') {%>text-success<%} else {%> text-info tx-12 <%}%>"><%= users[i].role%></p>
                                    </div>
                                    <p class="text-muted tx-13"><%= users[i].assignedTasks%> Assigned Accounts</p>
                                  </div>
                                  </a>
                                  <%- include('partials/records') %>
                                <% } %>
                            </div>
                          </section>
            
                        </div>


                    </div>

					</div>

				</div>
				
				
				

			</div>
            	<!-- Expand Notes -->
			<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
				  <div class="modal-content card-body-alt">
            <div class="card-body-alt" style="max-height: 80rem;">
              <div class="card-body" >
                  <div class="d-flex justify-content-between align-items-baseline mb-2">
                    <h6 class="card-title mb-0">Users</h6>
                   
                  </div>
                  <div class="d-flex flex-column mt-3" >
                   
                    <%for (i in users) {%>
                      <a href="#" class="d-flex align-items-center border-bottom pb-3" data-toggle="modal" data-target="#records<%=[i]%>">
                          <div class="mr-3">
                            <img src="https://via.placeholder.com/35x35" class="rounded-circle wd-35" alt="user">
                          </div>
                          <div class="w-100">
                            <div class="d-flex justify-content-between">
                              <h6 class="text-body my-2"><%= users[i].name%></h6>
                              <p class="my-2 <%if (users[i].role == 'Admin') {%>text-success<%} else {%> text-info tx-12 <%}%>"><%= users[i].role%></p>
                            </div>
                            <p class="text-muted tx-13">Has <%= users[i].assignedTasks%> Assigned Accounts</p>
                          </div>
                        </a>
                        <%- include('partials/records') %>
                    <% } %>
                  </div>
                </div>
              </div>
				  </div>
				</div>
			  </div>
	      <div class="modal fade myClients" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
				  <div class="modal-content card-body-alt">
					<table class="table table-striped " >
						<thead class="border-info">
							<tr>
								<th>
									Title
								</th>
								<th>
									Assigned To
								</th>
								<th>
									Status
								</th>
								<th>
									Deadline
								</th>
								
							</tr>
						</thead>
						<tbody>
							<% for (i in tasks) {%>
								<tr>
									<td>
										<a href="/mm/task/<%= tasks[i]._id%>"><%= tasks[i].title%></a>
									</td>

									<td>
										<%= tasks[i].taskFor%>

									</td>

									<td>
										<%= tasks[i].status%>
									</td>

                  <td>
										<%= tasks[i].deadline%>
									</td>
								</tr>
							<% } %>
							
						</tbody>
					</table>
				  </div>
				</div>
			  </div>

          <!-- Add  Task -->
          <div class="modal fade" id="tasks_" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">New Task</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form action="/mm/tasks" method="post">
                    <div class="row">
                <div class="col">
                  <div class="form-group">
                    <label for="recipient-name" class="col-form-label">Title:</label>
                    <input type="text" class="form-control" name="title" id="recipient-name">
                    </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label for="recipient-name" class="col-form-label">Recipient:</label>
                    <select name="taskFor" class="form-control form-control-sm mb-3">
                      <option  selected=""></option>
                      <%for (i in users) {%>
                        <%if (users[i].role != 'Admin') {%>
                          <option  value="<%= users[i].id%>">
          
                            <%= users[i].name%>
                          </option>
                        <% } %>
                      <% } %>
                    </select>
                    </div>
                </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="recipient-name" class="col-form-label">Ref. Carrier:</label>
                      <select name="reference" class="form-control form-control-sm mb-3">
                        <option  selected=""></option>
                        <%for (i in trackers) {%>
                          <option  value="<%= trackers[i]._id%>">
          
                            <%= trackers[i].Customer_Name%>
                          </option>
                        <% } %>
                      </select>
                      </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="recipient-name" class="col-form-label">Deadline:</label>
                      <div class="input-group date datepicker" id="datePickerExample">
                        <input name="deadline" type="text" class="form-control"><span class="input-group-addon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></span>
                      </div>
                      </div>
                  </div>
                </div>
               
                    <div class="form-group">
                      <label for="message-text" class="col-form-label">Description:</label>
                      <textarea class="form-control" id="message-text" name="description"></textarea>
                    </div>
          
                <div class=" page-content d-flex justify-content-center align-items-center">
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary"><i data-feather="plus"></i> 
                  Task
                </button>
                </div>
              </div>
                  </form>
                </div>
              
              </div>
            </div>
          </div>


		
		</div>
		
	</div>

  <%- include('includes/end') %>
<!-- End Includes -->

<!-- <script src="../../../assets/js/template.js"></script>
<script src="../../../assets/js/dashboard.js"></script> -->
